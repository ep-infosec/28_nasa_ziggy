// Ziggy Gradle Build File
//
// This file contains the declarative portion of the build only.
// Imperative tasks are found in script-plugins and are applied at the
// bottom of this file.

// See comment for ziggyDependencies in gradle.properties.
ext.ziggyDependencies = "$rootDir/$ziggyDependencies"

apply plugin: 'java'
apply plugin: 'eclipse'

defaultTasks "assemble"

repositories {
    mavenCentral()
    flatDir {
        dirs "$ziggyDependencies/lib"
    }
}

dependencies {
    // Needed to compile ziggy.
    compile 'com.github.librepdf:openpdf:1.3.+'
    compile 'com.github.testdriven.guice:commons-configuration:1.+'
    compile 'com.google.guava:guava:23.+'
    compile 'com.jgoodies:jgoodies-forms:1.9.+'
    compile 'com.jgoodies:jgoodies-looks:2.7.+'
    compile 'commons-cli:commons-cli:1.5.+'
    compile 'commons-codec:commons-codec:1.+'
    compile 'commons-io:commons-io:2.11.+'
    compile 'org.apache.commons:commons-collections4:4.+'
    compile 'org.apache.commons:commons-compress:1.+'
    compile 'org.apache.commons:commons-csv:1.9.+'
    compile 'org.apache.commons:commons-exec:1.+'
    compile 'org.apache.commons:commons-lang3:3.12.+'
    compile 'org.apache.commons:commons-math3:3.6.+'
    compile 'org.apache.commons:commons-text:1.+'
    compile 'org.apache.logging.log4j:log4j-api:2.17.+'
    compile 'org.apache.logging.log4j:log4j-core:2.17.+'
    compile 'org.apache.logging.log4j:log4j-slf4j-impl:2.17.+'
    compile 'org.hibernate.javax.persistence:hibernate-jpa-2.0-api:1.0.+'
    compile 'org.hibernate:hibernate-core:4.2.+'
    compile 'org.javassist:javassist:3.18.1-GA'
    compile 'org.jfree:jfreechart:1.0.+'
    compile 'org.netbeans.api:org-netbeans-swing-outline:+'
    compile 'org.tros:l2fprod-properties-editor:1.3.+'
    compile 'tanukisoft:wrapper:3.2.+'

    // Libraries built in buildSrc.
    compile ':jarhdf5:1.12.+'

    // Needed to compile unit tests.
    compile 'junit:junit:4.+'
    compile 'org.hamcrest:hamcrest:2.+'
    compile 'org.mockito:mockito-core:1.10.+'

    // Needed to run unit tests.
    // hsqldb version 2.3.4 causes PipelineInstanceTaskCrudTest to
    // fail with HsqlException: data exception: datetime field
    // overflow. This can be fixed by replacing Long.MAX_VALUE with a
    // smaller date. Other problems ensue with version 2.6.
    compile 'org.hsqldb:hsqldb:2.3.2'

    // Needed at runtime.
    compile 'org.postgresql:postgresql:9.4-1201-jdbc4'
}

test {
    systemProperty "log4j2.configurationFile","$projectDir/test/data/logging/log4j2.xml"
    systemProperty "java.library.path", "$ziggyDependencies/lib"
    
    forkEvery = 1

    testLogging {
        events "failed", "skipped"
    }

    // The RMI tests appear to have an ordering sensitivity. To wit,
    // If Intra- runs before Inter-, they all run successfully.
    // If Inter- runs before Intra-, Intra- tests all fail.
    // Nonetheless, these tests are good to have for interactive use,
    // as they allow to troubleshoot RMI problems more simply. Thus,
    // we leave that class out of gradle test but keep it around in case
    // we need it.
    exclude "**/RmiInt*"
}

javadoc {
    title = "Ziggy API"
    options.overview = "src/main/java/overview.html"
}

// Apply Ziggy Gradle script plugins.
apply from: "script-plugins/copy.gradle"
apply from: "script-plugins/database-schemas.gradle"
apply from: "script-plugins/eclipse.gradle"
apply from: "script-plugins/gcc.gradle"
apply from: "script-plugins/hdf5.gradle"
// apply from: "script-plugins/matlab.gradle"
apply from: "script-plugins/misc.gradle"
apply from: "script-plugins/test.gradle"
apply from: "script-plugins/wrapper.gradle"
apply from: "script-plugins/xml-schemas.gradle"
apply from: "script-plugins/ziggy-libraries.gradle"
